generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ==================== BENUTZER & ROLLEN ====================

model User {
  id            String   @id @default(cuid())
  discordId     String   @unique
  username      String
  displayName   String?
  avatar        String?
  email         String?
  roleId        String?
  role          Role?    @relation(fields: [roleId], references: [id])
  isActive      Boolean  @default(true)
  lastLogin     DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relationen
  employee         Employee?
  applications     Application[]     @relation("ApplicationReviewer")
  createdApplications Application[]  @relation("ApplicationCreator")
  evaluationsGiven Evaluation[]      @relation("EvaluationGiver")
  evaluationsReceived Evaluation[]   @relation("EvaluationReceiver")
  trainingsAsTutor Training[]        @relation("TrainingTutor")
  trainingsAsParticipant TrainingParticipant[]
  qualityReports   QualityReport[]
  transactions     Transaction[]
  evidenceActions  EvidenceLog[]
  robberyReports   RobberyReport[]
  specialPayments  SpecialPayment[]
  absences         Absence[]
  tuningInvoices   TuningInvoice[]
  announcements    Announcement[]
  auditLogs        AuditLog[]

  @@map("users")
}

model Role {
  id            String   @id @default(cuid())
  name          String   @unique
  displayName   String
  color         String   @default("#6B7280")
  discordRoleId String?
  level         Int      @default(0) // HÃ¶her = mehr Rechte
  permissions   Permission[]
  users         User[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("roles")
}

model Permission {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?
  category    String   // admin, hr, ia, academy, qa, finance, etc.
  roles       Role[]
  createdAt   DateTime @default(now())

  @@map("permissions")
}

// ==================== PERSONAL ====================

model Employee {
  id            String   @id @default(cuid())
  userId        String   @unique
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  badgeNumber   String?  @unique
  rank          String   @default("Cadet")
  department    String   @default("Patrol")
  status        EmployeeStatus @default(ACTIVE)
  hireDate      DateTime @default(now())
  notes         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("employees")
}

enum EmployeeStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  ON_LEAVE
  TERMINATED
}

// ==================== HUMAN RESOURCES ====================

model Application {
  id            String   @id @default(cuid())
  applicantName String
  discordId     String?
  discordName   String?
  status        ApplicationStatus @default(PENDING)
  notes         String?
  interviewDate DateTime?
  reviewerId    String?
  reviewer      User?    @relation("ApplicationReviewer", fields: [reviewerId], references: [id])
  createdById   String?
  createdBy     User?    @relation("ApplicationCreator", fields: [createdById], references: [id])
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("applications")
}

enum ApplicationStatus {
  PENDING
  INTERVIEW_SCHEDULED
  INTERVIEW_COMPLETED
  ACCEPTED
  REJECTED
  WITHDRAWN
}

// ==================== INTERNAL AFFAIRS ====================

model Evaluation {
  id          String   @id @default(cuid())
  employeeId  String
  employee    User     @relation("EvaluationReceiver", fields: [employeeId], references: [id])
  evaluatorId String
  evaluator   User     @relation("EvaluationGiver", fields: [evaluatorId], references: [id])
  type        EvaluationType @default(PERFORMANCE)
  rating      Int      // 1-5
  comment     String?
  isPositive  Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("evaluations")
}

enum EvaluationType {
  PERFORMANCE
  WARNING
  COMMENDATION
  INVESTIGATION
  NOTE
}

// ==================== POLICE ACADEMY ====================

model Training {
  id            String   @id @default(cuid())
  name          String
  description   String?
  type          TrainingType @default(BASIC)
  tutorId       String
  tutor         User     @relation("TrainingTutor", fields: [tutorId], references: [id])
  scheduledAt   DateTime?
  completedAt   DateTime?
  status        TrainingStatus @default(SCHEDULED)
  maxParticipants Int?
  participants  TrainingParticipant[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("trainings")
}

model TrainingParticipant {
  id          String   @id @default(cuid())
  trainingId  String
  training    Training @relation(fields: [trainingId], references: [id], onDelete: Cascade)
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  passed      Boolean?
  grade       String?
  notes       String?
  createdAt   DateTime @default(now())

  @@unique([trainingId, userId])
  @@map("training_participants")
}

enum TrainingType {
  BASIC
  ADVANCED
  SPECIALIZATION
  CERTIFICATION
  REFRESHER
}

enum TrainingStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

// ==================== QUALITY ASSURANCE ====================

model QualityReport {
  id          String   @id @default(cuid())
  unit        String
  rating      Int      // 1-5
  report      String
  suggestions String?
  reviewerId  String
  reviewer    User     @relation(fields: [reviewerId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("quality_reports")
}

// ==================== FINANZEN ====================

model Transaction {
  id          String   @id @default(cuid())
  type        TransactionType
  amount      Float
  category    String
  description String?
  reference   String?
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  createdAt   DateTime @default(now())

  @@map("transactions")
}

enum TransactionType {
  INCOME
  EXPENSE
}

model Evidence {
  id          String   @id @default(cuid())
  name        String
  description String?
  value       Float?
  status      EvidenceStatus @default(IN_STORAGE)
  location    String?
  caseNumber  String?
  logs        EvidenceLog[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("evidence")
}

model EvidenceLog {
  id          String   @id @default(cuid())
  evidenceId  String
  evidence    Evidence @relation(fields: [evidenceId], references: [id], onDelete: Cascade)
  action      String   // IN, OUT, DESTROYED, RELEASED
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  notes       String?
  createdAt   DateTime @default(now())

  @@map("evidence_logs")
}

enum EvidenceStatus {
  IN_STORAGE
  CHECKED_OUT
  RELEASED
  DESTROYED
}

model RobberyReport {
  id          String   @id @default(cuid())
  date        DateTime @default(now())
  location    String
  damage      Float
  description String
  suspects    String?
  status      RobberyStatus @default(OPEN)
  reporterId  String
  reporter    User     @relation(fields: [reporterId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("robbery_reports")
}

enum RobberyStatus {
  OPEN
  INVESTIGATING
  SOLVED
  CLOSED
}

model SpecialPayment {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  amount      Float
  reason      String
  status      PaymentStatus @default(PENDING)
  approvedBy  String?
  approvedAt  DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("special_payments")
}

enum PaymentStatus {
  PENDING
  APPROVED
  REJECTED
  PAID
}

model Absence {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  type        AbsenceType
  startDate   DateTime
  endDate     DateTime
  reason      String?
  status      AbsenceStatus @default(PENDING)
  approvedBy  String?
  approvedAt  DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("absences")
}

enum AbsenceType {
  VACATION
  SICK
  PERSONAL
  TRAINING
  OTHER
}

enum AbsenceStatus {
  PENDING
  APPROVED
  REJECTED
}

model TuningInvoice {
  id          String   @id @default(cuid())
  vehicle     String
  licensePlate String?
  amount      Float
  description String
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  createdAt   DateTime @default(now())

  @@map("tuning_invoices")
}

// ==================== KOMMUNIKATION ====================

model Announcement {
  id            String   @id @default(cuid())
  title         String
  content       String
  priority      AnnouncementPriority @default(NORMAL)
  discordChannelId String?
  discordMessageId String?
  publishedAt   DateTime?
  authorId      String
  author        User     @relation(fields: [authorId], references: [id])
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("announcements")
}

enum AnnouncementPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

// ==================== SYSTEM ====================

model AuditLog {
  id        String   @id @default(cuid())
  action    String
  entity    String
  entityId  String?
  details   Json?
  ipAddress String?
  userAgent String?
  userId    String?
  user      User?    @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())

  @@index([entity, entityId])
  @@index([userId])
  @@index([createdAt])
  @@map("audit_logs")
}

model Backup {
  id        String   @id @default(cuid())
  filename  String
  size      Int
  path      String
  status    BackupStatus @default(COMPLETED)
  createdAt DateTime @default(now())

  @@map("backups")
}

enum BackupStatus {
  IN_PROGRESS
  COMPLETED
  FAILED
}

model SystemSetting {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("system_settings")
}
