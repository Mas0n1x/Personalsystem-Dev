generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// ==================== BENUTZER & ROLLEN ====================

model User {
  id            String   @id @default(cuid())
  discordId     String   @unique
  username      String
  displayName   String?
  avatar        String?
  email         String?
  roleId        String?
  role          Role?    @relation(fields: [roleId], references: [id])
  isActive      Boolean  @default(true)
  lastLogin     DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relationen
  employee      Employee?
  auditLogs     AuditLog[]

  @@map("users")
}

model Role {
  id            String   @id @default(cuid())
  name          String   @unique
  displayName   String
  color         String   @default("#6B7280")
  discordRoleId String?
  level         Int      @default(0)
  permissions   Permission[]
  users         User[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("roles")
}

model Permission {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?
  category    String
  roles       Role[]
  createdAt   DateTime @default(now())

  @@map("permissions")
}

// ==================== PERSONAL ====================

model Employee {
  id            String   @id @default(cuid())
  userId        String   @unique
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  badgeNumber   String?  @unique
  rank          String   @default("Cadet")
  rankLevel     Int      @default(0) // 1-17 aus Discord Rollen
  department    String   @default("Patrol")
  status        String   @default("ACTIVE") // ACTIVE, INACTIVE, SUSPENDED, ON_LEAVE, TERMINATED
  hireDate      DateTime @default(now())
  notes         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relationen
  absences      Absence[]

  @@map("employees")
}

// ==================== ABMELDUNGEN ====================

model Absence {
  id          String   @id @default(cuid())
  employeeId  String
  employee    Employee @relation(fields: [employeeId], references: [id], onDelete: Cascade)
  type        String   // "ABSENCE" = Abmeldung, "DAY_OFF" = Dienstfrei
  reason      String?
  startDate   DateTime
  endDate     DateTime
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([employeeId])
  @@index([startDate, endDate])
  @@map("absences")
}

// ==================== SYSTEM ====================

model AuditLog {
  id        String   @id @default(cuid())
  action    String
  entity    String
  entityId  String?
  details   String?
  ipAddress String?
  userAgent String?
  userId    String?
  user      User?    @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())

  @@index([entity, entityId])
  @@index([userId])
  @@index([createdAt])
  @@map("audit_logs")
}

model Backup {
  id        String   @id @default(cuid())
  filename  String
  size      Int
  path      String
  status    String   @default("COMPLETED")
  createdAt DateTime @default(now())

  @@map("backups")
}

model SystemSetting {
  id        String   @id @default(cuid())
  key       String   @unique
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("system_settings")
}
